

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: helper/shapeResizeHelper.js | ImageEditor</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 150px; height: 13px">
        
            <a href="https://github.com/nhn/tui.jsdoc-template" rel="noopener noreferrer" target="_blank">
                <img src="https://user-images.githubusercontent.com/35218826/40895380-0b9f4cd6-67ea-11e8-982f-18121daa3a04.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">ImageEditor</a></h1>
        
            <span class="version">v3.5.2</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-example01-includeUi.html">1. Include ui</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="example01-includeUi_sub"></div></li><li><a href="tutorial-example02-useApiDirect.html">2. Use api direct (basic)</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="example02-useApiDirect_sub"></div></li><li><a href="tutorial-example03-mobile.html">3. Mobile</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="example03-mobile_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="ImageEditor.html">ImageEditor</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImageEditor_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="ImageEditor.html#addIcon">addIcon</a></li><li><a href="ImageEditor.html#addImageObject">addImageObject</a></li><li><a href="ImageEditor.html#addShape">addShape</a></li><li><a href="ImageEditor.html#addText">addText</a></li><li><a href="ImageEditor.html#applyFilter">applyFilter</a></li><li><a href="ImageEditor.html#changeCursor">changeCursor</a></li><li><a href="ImageEditor.html#changeIconColor">changeIconColor</a></li><li><a href="ImageEditor.html#changeSelectableAll">changeSelectableAll</a></li><li><a href="ImageEditor.html#changeShape">changeShape</a></li><li><a href="ImageEditor.html#changeText">changeText</a></li><li><a href="ImageEditor.html#changeTextStyle">changeTextStyle</a></li><li><a href="ImageEditor.html#clearObjects">clearObjects</a></li><li><a href="ImageEditor.html#clearRedoStack">clearRedoStack</a></li><li><a href="ImageEditor.html#clearUndoStack">clearUndoStack</a></li><li><a href="ImageEditor.html#crop">crop</a></li><li><a href="ImageEditor.html#deactivateAll">deactivateAll</a></li><li><a href="ImageEditor.html#destroy">destroy</a></li><li><a href="ImageEditor.html#discardSelection">discardSelection</a></li><li><a href="ImageEditor.html#flipX">flipX</a></li><li><a href="ImageEditor.html#flipY">flipY</a></li><li><a href="ImageEditor.html#getCanvasSize">getCanvasSize</a></li><li><a href="ImageEditor.html#getCropzoneRect">getCropzoneRect</a></li><li><a href="ImageEditor.html#getDrawingMode">getDrawingMode</a></li><li><a href="ImageEditor.html#getImageName">getImageName</a></li><li><a href="ImageEditor.html#getObjectPosition">getObjectPosition</a></li><li><a href="ImageEditor.html#getObjectProperties">getObjectProperties</a></li><li><a href="ImageEditor.html#hasFilter">hasFilter</a></li><li><a href="ImageEditor.html#isEmptyRedoStack">isEmptyRedoStack</a></li><li><a href="ImageEditor.html#isEmptyUndoStack">isEmptyUndoStack</a></li><li><a href="ImageEditor.html#loadImageFromFile">loadImageFromFile</a></li><li><a href="ImageEditor.html#loadImageFromURL">loadImageFromURL</a></li><li><a href="ImageEditor.html#redo">redo</a></li><li><a href="ImageEditor.html#registerIcons">registerIcons</a></li><li><a href="ImageEditor.html#removeActiveObject">removeActiveObject</a></li><li><a href="ImageEditor.html#removeFilter">removeFilter</a></li><li><a href="ImageEditor.html#removeObject">removeObject</a></li><li><a href="ImageEditor.html#resetFlip">resetFlip</a></li><li><a href="ImageEditor.html#resizeCanvasDimension">resizeCanvasDimension</a></li><li><a href="ImageEditor.html#rotate">rotate</a></li><li><a href="ImageEditor.html#setAngle">setAngle</a></li><li><a href="ImageEditor.html#setBrush">setBrush</a></li><li><a href="ImageEditor.html#setCropzoneRect">setCropzoneRect</a></li><li><a href="ImageEditor.html#setDrawingShape">setDrawingShape</a></li><li><a href="ImageEditor.html#setObjectPosition">setObjectPosition</a></li><li><a href="ImageEditor.html#setObjectProperties">setObjectProperties</a></li><li><a href="ImageEditor.html#setObjectPropertiesQuietly">setObjectPropertiesQuietly</a></li><li><a href="ImageEditor.html#startDrawingMode">startDrawingMode</a></li><li><a href="ImageEditor.html#stopDrawingMode">stopDrawingMode</a></li><li><a href="ImageEditor.html#toDataURL">toDataURL</a></li><li><a href="ImageEditor.html#undo">undo</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="ImageEditor.html#event:addText">addText</a></li><li><a href="ImageEditor.html#event:mousedown">mousedown</a></li><li><a href="ImageEditor.html#event:objectActivated">objectActivated</a></li><li><a href="ImageEditor.html#event:objectMoved">objectMoved</a></li><li><a href="ImageEditor.html#event:objectScaled">objectScaled</a></li><li><a href="ImageEditor.html#event:redoStackChanged">redoStackChanged</a></li><li><a href="ImageEditor.html#event:textEditing">textEditing</a></li><li><a href="ImageEditor.html#event:undoStackChanged">undoStackChanged</a></li></ul></div></li><li><a href="Locale.html">Locale</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Locale_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Locale.html#localize">localize</a></li></ul></div></li><li><a href="Ui.html">Ui</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Ui_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Ui.html#resizeEditor">resizeEditor</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3><a href="global.html">Global</a></h3></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author NHN Ent. FE Development Team &lt;dl_javascript@nhn.com>
 * @fileoverview Shape resize helper
 */
const DIVISOR = {
    rect: 1,
    circle: 2,
    triangle: 1
};
const DIMENSION_KEYS = {
    rect: {
        w: 'width',
        h: 'height'
    },
    circle: {
        w: 'rx',
        h: 'ry'
    },
    triangle: {
        w: 'width',
        h: 'height'
    }
};

/**
 * Set the start point value to the shape object
 * @param {fabric.Object} shape - Shape object
 * @ignore
 */
function setStartPoint(shape) {
    const originX = shape.getOriginX();
    const originY = shape.getOriginY();
    const originKey = originX.substring(0, 1) + originY.substring(0, 1);

    shape.startPoint = shape.origins[originKey];
}

/**
 * Get the positions of ratated origin by the pointer value
 * @param {{x: number, y: number}} origin - Origin value
 * @param {{x: number, y: number}} pointer - Pointer value
 * @param {number} angle - Rotating angle
 * @returns {Object} Postions of origin
 * @ignore
 */
function getPositionsOfRotatedOrigin(origin, pointer, angle) {
    const sx = origin.x;
    const sy = origin.y;
    const px = pointer.x;
    const py = pointer.y;
    const r = angle * Math.PI / 180;
    const rx = ((px - sx) * Math.cos(r)) - ((py - sy) * Math.sin(r)) + sx;
    const ry = ((px - sx) * Math.sin(r)) + ((py - sy) * Math.cos(r)) + sy;

    return {
        originX: (sx > rx) ? 'right' : 'left',
        originY: (sy > ry) ? 'bottom' : 'top'
    };
}

/**
 * Whether the shape has the center origin or not
 * @param {fabric.Object} shape - Shape object
 * @returns {boolean} State
 * @ignore
 */
function hasCenterOrigin(shape) {
    return (shape.getOriginX() === 'center' &amp;&amp;
            shape.getOriginY() === 'center');
}

/**
 * Adjust the origin of shape by the start point
 * @param {{x: number, y: number}} pointer - Pointer value
 * @param {fabric.Object} shape - Shape object
 * @ignore
 */
function adjustOriginByStartPoint(pointer, shape) {
    const centerPoint = shape.getPointByOrigin('center', 'center');
    const angle = -shape.getAngle();
    const originPositions = getPositionsOfRotatedOrigin(centerPoint, pointer, angle);
    const {originX, originY} = originPositions;
    const origin = shape.getPointByOrigin(originX, originY);
    const left = shape.getLeft() - (centerPoint.x - origin.x);
    const top = shape.getTop() - (centerPoint.x - origin.y);

    shape.set({
        originX,
        originY,
        left,
        top
    });

    shape.setCoords();
}

/**
 * Adjust the origin of shape by the moving pointer value
 * @param {{x: number, y: number}} pointer - Pointer value
 * @param {fabric.Object} shape - Shape object
 * @ignore
 */
function adjustOriginByMovingPointer(pointer, shape) {
    const origin = shape.startPoint;
    const angle = -shape.getAngle();
    const originPositions = getPositionsOfRotatedOrigin(origin, pointer, angle);
    const {originX, originY} = originPositions;

    shape.setPositionByOrigin(origin, originX, originY);
}

/**
 * Adjust the dimension of shape on firing scaling event
 * @param {fabric.Object} shape - Shape object
 * @ignore
 */
function adjustDimensionOnScaling(shape) {
    const {type, scaleX, scaleY} = shape;
    const dimensionKeys = DIMENSION_KEYS[type];
    let width = shape[dimensionKeys.w] * scaleX;
    let height = shape[dimensionKeys.h] * scaleY;

    if (shape.isRegular) {
        const maxScale = Math.max(scaleX, scaleY);

        width = shape[dimensionKeys.w] * maxScale;
        height = shape[dimensionKeys.h] * maxScale;
    }

    const options = {
        hasControls: false,
        hasBorders: false,
        scaleX: 1,
        scaleY: 1
    };

    options[dimensionKeys.w] = width;
    options[dimensionKeys.h] = height;

    shape.set(options);
}

/**
 * Adjust the dimension of shape on firing mouse move event
 * @param {{x: number, y: number}} pointer - Pointer value
 * @param {fabric.Object} shape - Shape object
 * @ignore
 */
function adjustDimensionOnMouseMove(pointer, shape) {
    const {type, strokeWidth, startPoint: origin} = shape;
    const divisor = DIVISOR[type];
    const dimensionKeys = DIMENSION_KEYS[type];
    const isTriangle = !!(shape.type === 'triangle');
    const options = {};
    let width = Math.abs(origin.x - pointer.x) / divisor;
    let height = Math.abs(origin.y - pointer.y) / divisor;

    if (width > strokeWidth) {
        width -= strokeWidth / divisor;
    }

    if (height > strokeWidth) {
        height -= strokeWidth / divisor;
    }

    if (shape.isRegular) {
        width = height = Math.max(width, height);

        if (isTriangle) {
            height = Math.sqrt(3) / 2 * width;
        }
    }

    options[dimensionKeys.w] = width;
    options[dimensionKeys.h] = height;

    shape.set(options);
}

module.exports = {
    /**
     * Set each origin value to shape
     * @param {fabric.Object} shape - Shape object
     */
    setOrigins(shape) {
        const leftTopPoint = shape.getPointByOrigin('left', 'top');
        const rightTopPoint = shape.getPointByOrigin('right', 'top');
        const rightBottomPoint = shape.getPointByOrigin('right', 'bottom');
        const leftBottomPoint = shape.getPointByOrigin('left', 'bottom');

        shape.origins = {
            lt: leftTopPoint,
            rt: rightTopPoint,
            rb: rightBottomPoint,
            lb: leftBottomPoint
        };
    },

    /**
     * Resize the shape
     * @param {fabric.Object} shape - Shape object
     * @param {{x: number, y: number}} pointer - Mouse pointer values on canvas
     * @param {boolean} isScaling - Whether the resizing action is scaling or not
     */
    resize(shape, pointer, isScaling) {
        if (hasCenterOrigin(shape)) {
            adjustOriginByStartPoint(pointer, shape);
            setStartPoint(shape);
        }

        if (isScaling) {
            adjustDimensionOnScaling(shape, pointer);
        } else {
            adjustDimensionOnMouseMove(pointer, shape);
        }

        adjustOriginByMovingPointer(pointer, shape);
    },

    /**
     * Adjust the origin position of shape to center
     * @param {fabric.Object} shape - Shape object
     */
    adjustOriginToCenter(shape) {
        const centerPoint = shape.getPointByOrigin('center', 'center');
        const originX = shape.getOriginX();
        const originY = shape.getOriginY();
        const origin = shape.getPointByOrigin(originX, originY);
        const left = shape.getLeft() + (centerPoint.x - origin.x);
        const top = shape.getTop() + (centerPoint.y - origin.y);

        shape.set({
            hasControls: true,
            hasBorders: true,
            originX: 'center',
            originY: 'center',
            left,
            top
        });

        shape.setCoords(); // For left, top properties
    }
};
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://user-images.githubusercontent.com/35218826/40895380-0b9f4cd6-67ea-11e8-982f-18121daa3a04.png" style="width: 150px; height: 13px">
    <div class="footer-text">NHN Entertainment. Frontend Development Lab</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
